<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.piaohai.mis.dao.DocumentMapper" >
  <resultMap id="BaseResultMap" type="com.piaohai.mis.model.Document" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    <id column="DOC_ID" property="docId" jdbcType="VARCHAR" />
    <result column="DOC_TITLE" property="docTitle" jdbcType="VARCHAR" />
    <result column="DOC_CHANNEL" property="docChannel" jdbcType="VARCHAR" />
    <result column="DOC_STATUS" property="docStatus" jdbcType="VARCHAR" />
    <result column="DOC_ATTACH" property="docAttach" jdbcType="VARCHAR" />
    <result column="DOC_PS" property="docPs" jdbcType="VARCHAR" />
    <result column="DATE_CREATED" property="dateCreated" jdbcType="TIMESTAMP" />
    <result column="DATE_MODIFIED" property="dateModified" jdbcType="TIMESTAMP" />
    <result column="CREATER" property="creater" jdbcType="VARCHAR" />
    <result column="MODIFIER" property="modifier" jdbcType="VARCHAR" />
    <result column="DOC_DETAIL_PAGE" property="docDetailPage" jdbcType="VARCHAR" />
    
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.piaohai.mis.model.Document" extends="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    <result column="DOC_CONTENT" property="docContent" jdbcType="CLOB" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    DOC_ID, DOC_TITLE, DOC_CHANNEL, DOC_STATUS, DOC_ATTACH, DOC_PS, DATE_CREATED, DATE_MODIFIED, 
    CREATER, MODIFIER
  </sql>
  <sql id="Blob_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    DOC_CONTENT
  </sql>
  <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from DOCUMENT
    where DOC_ID = #{docId,jdbcType=VARCHAR}
  </select>
  
  <select id="selectByChannelId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from DOCUMENT
    where DOC_CHANNEL = #{docChannel,jdbcType=VARCHAR}
  </select>
  <!-- 分页查询 -->
  <select id="docListPage" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from DOCUMENT
    where DOC_CHANNEL = #{chanId,jdbcType=VARCHAR}
  </select>
  
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    delete from DOCUMENT
    where DOC_ID = #{docId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.piaohai.mis.model.Document" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    insert into DOCUMENT (DOC_ID, DOC_TITLE, DOC_CHANNEL, 
      DOC_STATUS, DOC_ATTACH, DOC_PS, 
      DATE_CREATED, DATE_MODIFIED, CREATER, 
      MODIFIER, DOC_CONTENT,DOC_DETAIL_PAGE)
    values (#{docId,jdbcType=VARCHAR}, #{docTitle,jdbcType=VARCHAR}, #{docChannel,jdbcType=VARCHAR}, 
      #{docStatus,jdbcType=VARCHAR}, #{docAttach,jdbcType=VARCHAR}, #{docPs,jdbcType=VARCHAR}, 
      #{dateCreated,jdbcType=TIMESTAMP}, #{dateModified,jdbcType=TIMESTAMP}, #{creater,jdbcType=VARCHAR}, 
      #{modifier,jdbcType=VARCHAR}, #{docContent,jdbcType=CLOB},#{docDetailPage,jdbcType=VARCHAR})
    <selectKey resultType="java.lang.String" order="BEFORE" keyProperty="docId"> 
	       SELECT SYS_GUID() FROM DUAL
	</selectKey>
  </insert>
  <insert id="insertSelective" parameterType="com.piaohai.mis.model.Document" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    insert into DOCUMENT
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="docId != null" >
        DOC_ID,
      </if>
      <if test="docTitle != null" >
        DOC_TITLE,
      </if>
      <if test="docChannel != null" >
        DOC_CHANNEL,
      </if>
      <if test="docStatus != null" >
        DOC_STATUS,
      </if>
      <if test="docAttach != null" >
        DOC_ATTACH,
      </if>
      <if test="docPs != null" >
        DOC_PS,
      </if>
      <if test="dateCreated != null" >
        DATE_CREATED,
      </if>
      <if test="dateModified != null" >
        DATE_MODIFIED,
      </if>
      <if test="creater != null" >
        CREATER,
      </if>
      <if test="modifier != null" >
        MODIFIER,
      </if>
      <if test="docContent != null" >
        DOC_CONTENT,
      </if>
       <if test="docDetailPage != null" >
        DOC_DETAIL_PAGE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="docId != null" >
        #{docId,jdbcType=VARCHAR},
      </if>
      <if test="docTitle != null" >
        #{docTitle,jdbcType=VARCHAR},
      </if>
      <if test="docChannel != null" >
        #{docChannel,jdbcType=VARCHAR},
      </if>
      <if test="docStatus != null" >
        #{docStatus,jdbcType=VARCHAR},
      </if>
      <if test="docAttach != null" >
        #{docAttach,jdbcType=VARCHAR},
      </if>
      <if test="docPs != null" >
        #{docPs,jdbcType=VARCHAR},
      </if>
      <if test="dateCreated != null" >
        #{dateCreated,jdbcType=TIMESTAMP},
      </if>
      <if test="dateModified != null" >
        #{dateModified,jdbcType=TIMESTAMP},
      </if>
      <if test="creater != null" >
        #{creater,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="docContent != null" >
        #{docContent,jdbcType=CLOB},
      </if>
      <if test="docDetailPage != null" >
      	 #{docDetailPage,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.piaohai.mis.model.Document" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    update DOCUMENT
    <set >
      <if test="docTitle != null" >
        DOC_TITLE = #{docTitle,jdbcType=VARCHAR},
      </if>
      <if test="docChannel != null" >
        DOC_CHANNEL = #{docChannel,jdbcType=VARCHAR},
      </if>
      <if test="docStatus != null" >
        DOC_STATUS = #{docStatus,jdbcType=VARCHAR},
      </if>
      <if test="docAttach != null" >
        DOC_ATTACH = #{docAttach,jdbcType=VARCHAR},
      </if>
      <if test="docPs != null" >
        DOC_PS = #{docPs,jdbcType=VARCHAR},
      </if>
      <if test="dateCreated != null" >
        DATE_CREATED = #{dateCreated,jdbcType=TIMESTAMP},
      </if>
      <if test="dateModified != null" >
        DATE_MODIFIED = #{dateModified,jdbcType=TIMESTAMP},
      </if>
      <if test="creater != null" >
        CREATER = #{creater,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        MODIFIER = #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="docContent != null" >
        DOC_CONTENT = #{docContent,jdbcType=CLOB},
      </if>
      <if test="docDetailPage != null" >
      	DOC_DETAIL_PAGE = #{docDetailPage,jdbcType=VARCHAR},
      </if>
    </set>
    where DOC_ID = #{docId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.piaohai.mis.model.Document" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    update DOCUMENT
    set DOC_TITLE = #{docTitle,jdbcType=VARCHAR},
      DOC_CHANNEL = #{docChannel,jdbcType=VARCHAR},
      DOC_STATUS = #{docStatus,jdbcType=VARCHAR},
      DOC_ATTACH = #{docAttach,jdbcType=VARCHAR},
      DOC_PS = #{docPs,jdbcType=VARCHAR},
      DATE_CREATED = #{dateCreated,jdbcType=TIMESTAMP},
      DATE_MODIFIED = #{dateModified,jdbcType=TIMESTAMP},
      CREATER = #{creater,jdbcType=VARCHAR},
      MODIFIER = #{modifier,jdbcType=VARCHAR},
      DOC_CONTENT = #{docContent,jdbcType=CLOB}
    where DOC_ID = #{docId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.piaohai.mis.model.Document" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    update DOCUMENT
    set DOC_TITLE = #{docTitle,jdbcType=VARCHAR},
      DOC_CHANNEL = #{docChannel,jdbcType=VARCHAR},
      DOC_STATUS = #{docStatus,jdbcType=VARCHAR},
      DOC_ATTACH = #{docAttach,jdbcType=VARCHAR},
      DOC_PS = #{docPs,jdbcType=VARCHAR},
      DATE_CREATED = #{dateCreated,jdbcType=TIMESTAMP},
      DATE_MODIFIED = #{dateModified,jdbcType=TIMESTAMP},
      CREATER = #{creater,jdbcType=VARCHAR},
      MODIFIER = #{modifier,jdbcType=VARCHAR}
    where DOC_ID = #{docId,jdbcType=VARCHAR}
  </update>
  
   <resultMap type="com.piaohai.mis.model.Document" id="docDetailMap" extends="ResultMapWithBLOBs">
  		<collection  property="attachments" javaType="list" ofType="com.piaohai.mis.model.Attachment">
  			<id property="attaId" column="ATTA_ID"/>
  			<result property="attaName" column="ATTA_NAME"/>
  			<result property="attaLocation" column="ATTA_LOCATION"/>
  			<result property="attaPs" column="ATTA_PS"/>
  		</collection>
	  </resultMap>
	  
 <select id="getDocDetail" resultMap="docDetailMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    select DOC_ID,
        DOC_TITLE,
        DOC_CHANNEL,
        DOC_STATUS,
        DOC_ATTACH,
        DOC_PS,
        doc.DATE_CREATED,
        doc.DATE_MODIFIED,
        doc.CREATER,
        doc.MODIFIER,
        DOC_CONTENT,
        DOC_DETAIL_PAGE,
        am.ATTA_ID,
        am.ATTA_NAME,
        am.ATTA_SIZE,
        am.ATTA_TYPE,
        am.ATTA_LOCATION,
        am.ATTA_PS
   from DOCUMENT doc
   left join Atta_Relation ar
     on ar.atre_relation_id = doc.doc_id
   left join attachment am
     on am.atta_id = ar.atre_atta_id
    where doc.DOC_ID = #{docId,jdbcType=VARCHAR}
   
  </select>
  
  <select id="docListPageByChannel" resultMap="docDetailMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 17 13:54:42 CST 2013.
    -->
    select DOC_ID,
        DOC_TITLE,
        DOC_CHANNEL,
        DOC_STATUS,
        DOC_ATTACH,
        DOC_PS,
        doc.DATE_CREATED,
        doc.DATE_MODIFIED,
        doc.CREATER,
        DOC_DETAIL_PAGE,
        doc.MODIFIER,
        DOC_CONTENT,
        am.ATTA_ID,
        am.ATTA_NAME,
        am.ATTA_SIZE,
        am.ATTA_TYPE,
        am.ATTA_LOCATION,
        am.ATTA_PS
   from DOCUMENT doc
   left join Atta_Relation ar
     on ar.atre_relation_id = doc.doc_id
   left join attachment am
     on am.atta_id = ar.atre_atta_id
    where doc.DOC_CHANNEL = #{docChannel,jdbcType=VARCHAR}
    and am.ATTA_ID is not null
  </select>
</mapper>